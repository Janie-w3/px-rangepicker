<link rel="import" href="../polymer/polymer.html"/>
<link rel="import" href="px-range-fields.html"/>
<link rel="import" href="px-rangepicker-modal.html"/>

<script src="../moment/moment.js"></script>

<!--
Rangepicker with time element.

##### Usage

    <px-rangepicker from-time={{...}} to-time={{...}}
                    from-date={{...}} to-date={{...}}>
    </px-rangepicker>
-->
<dom-module id="px-rangepicker">
  <template>
    <px-range-fields
      id="rangeFields"
      from="{{fromMoment}}"
      to="{{toMoment}}">
    </px-range-fields>
    <px-rangepicker-modal
      id=rangePickerModal
      from="{{fromMoment}}"
      to="{{toMoment}}"
      allow-future-dates="{{allowFutureDates}}"
      preset-ranges="{{presetRanges}}"
      hidden>
    </px-rangepicker-modal>
  </template>
</dom-module>

<script>
  Polymer({

    is: 'px-rangepicker',

    properties: {

      /**
       * Start date & time for time picker
       *
       * Format 'MM/DD/YYYY hh:mm:ss A', for example: '01/25/2015 10:22:00 AM'
       */
      from: {
        type: String,
        notify: true,
        observer: '_updateFrom'
      },

      /**
       * End date & time for time picker
       *
       * Format 'MM/DD/YYYY hh:mm:ss A', for example: '11/03/2015 04:55:00 PM'
       */
      to: {
        type: String,
        notify: true,
        observer: '_updateTo'
      },

      /**
       * (optional) Set this attribute when you do want to allow future dates in the date range picker.
       *
       * If not set, then future dates will be disabled and unclickable.
       */
      allowFutureDates: {
        type: Boolean,
        value: false
      },

      /**
       * (optional) The preset date/time ranges to be displayed.  Defaults to none.
       *
       *```
       *   [
       *    {
       *      "displayText": "Last 5 Minutes",
       *      "startDateTime": "08/21/2015 12:57:33 PM",
       *      "endDateTime": "08/21/2015 1:02:33 PM"
       *    },
       *    {
       *      "displayText": "Last 12 Hours",
       *      "startDateTime": "08/21/2015 1:02:33 AM",
       *      "endDateTime": "08/21/2015 1:02:33 PM"
       *    }
       *   ]
       * ```
       */
      presetRanges: Object

    },

    observers: [
      '_updateInputs(fromMoment, toMoment)'
    ],

    _updateInputs: function() {
      this.set('from', this.fromMoment.format('MM/DD/YYYY hh:mm:ss A'));
      this.set('to', this.toMoment.format('MM/DD/YYYY hh:mm:ss A'));
    },

    _updateFrom: function() {
      this.set('fromMoment', moment(this.from, 'MM/DD/YYYY hh:mm:ss A'));
    },

    _updateTo: function() {
      this.set('toMoment', moment(this.to, 'MM/DD/YYYY hh:mm:ss A'));
    },

    ready: function() {

      var self = this;

      this.$.rangeFields.addEventListener('px-selected-range-field', function(e) {
        self.$.rangePickerModal.toggleAttribute('hidden', false);
      });

      this.$.rangePickerModal.addEventListener('px-range-picking-done', function(e) {
        self.$.rangePickerModal.toggleAttribute('hidden', true);
      });
    }

//    // make a local copy of all time/date inputs to make changes until the user hits Apply
//
//    _copyTo: function() {
//      this.set('toInput', moment(this.to));
//    },
//
//    _copyFrom: function() {
//      this.set('fromInput', moment(this.from));
//    },


  });
</script>
