<link rel="import" href="../polymer/polymer.html"/>
<link rel="import" href="px-time-rangepicker.html"/>
<link rel="import" href="px-date-rangepicker.html"/>
<link rel="import" href="px-rangepicker-presets.html"/>

<script src="../moment/moment.js"></script>

<!--
Rangepicker modal.

##### Usage

    <px-rangepicker-modal from-time={{...}} to-time={{...}}
                          from-date={{...}} to-date={{...}}>
    </px-rangepicker-modal>
-->
<dom-module id="px-rangepicker-modal">
  <link rel="import" type="css" href="css/px-rangepicker.css"/>
  <template>
    <div class=overlay></div>
    <div id="rangepickerModal" class="rangepicker__box">
      <div class=flex>
        <div>
          <px-date-rangepicker
            id="dateRangePicker"
            class=u-p+
            from-date="{{from}}"
            to-date="{{to}}"
            allow-future-dates="{{allowFutureDates}}">
          </px-date-rangepicker>
          <px-time-rangepicker
            class="border--top u-p+"
            id="timeRangePicker"
            from-time="{{from}}"
            to-time="{{to}}">
          </px-time-rangepicker>
        </div>
        <template is="dom-if" if="{{presetRanges}}">
          <px-rangepicker-presets id="presets" class="border--left u-p+" preset-ranges="{{presetRanges}}">
          </px-rangepicker-presets>
        </template>
      </div>
      <div class="flex flex--right border--top u-p-">
        <button class=btn on-click="close">Close</button>
      </div>
    </div>
  </template>
</dom-module>

<script>
  Polymer({

    is: 'px-rangepicker-modal',

    properties: {

      /**
       * Moment object start date & time for range picker
       */
      from: {
        type: Object,
        notify: true
      },

      /**
       * Moment object end date & time for range picker
       */
      to: {
        type: Object,
        notify: true
      },

      /**
       * (optional) Set this attribute when you do want to allow future dates in the date range picker.
       *
       * If not set, then future dates will be disabled and unclickable.
       */
      allowFutureDates: {
        type: Boolean,
        value: false
      },

      /**
       * (optional) The preset date/time ranges to be displayed.  Defaults to none.
       *
       *```
       *   [
       *    {
       *      "displayText": "Last 5 Minutes",
       *      "startDateTime": "08/21/2015 12:57:33 PM",
       *      "endDateTime": "08/21/2015 1:02:33 PM"
       *    },
       *    {
       *      "displayText": "Last 12 Hours",
       *      "startDateTime": "08/21/2015 1:02:33 AM",
       *      "endDateTime": "08/21/2015 1:02:33 PM"
       *    }
       *   ]
       * ```
       */
      presetRanges: Object

    },

    ready: function() {
      var self = this;

      this.$.rangepickerModal.addEventListener('px-preset-selected', function(e) {
        var presetStartDateTime = e.detail.startDateTime;
        var presetEndDateTime = e.detail.endDateTime;

        self.set('from', moment(presetStartDateTime, 'MM/DD/YYYY hh:mm:ss A'));
        self.set('to', moment(presetEndDateTime, 'MM/DD/YYYY hh:mm:ss A'));
      });

    },

    /**
     * Open the modal
     */
    open: function() {
      if(this._isClosed()) {
        this.$.dateRangePicker._resetVisibleCalendars();
        this.toggleAttribute('hidden', false);
      }
    },

    /**
     * Close the modal
     */
    close: function() {
      this.toggleAttribute('hidden', true);
    },

    _isClosed: function() {
      return this.hidden;
    }

  });
</script>
