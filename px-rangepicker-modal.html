<link rel="import" href="../polymer/polymer.html"/>
<link rel="import" href="px-time-rangepicker.html"/>
<link rel="import" href="px-date-rangepicker.html"/>
<link rel="import" href="px-rangepicker-presets.html"/>

<script src="../moment/moment.js"></script>

<!--
Rangepicker modal.

##### Usage

    <px-rangepicker-modal from-time={{...}} to-time={{...}}
                          from-date={{...}} to-date={{...}}>
    </px-rangepicker-modal>
-->
<dom-module id="px-rangepicker-modal">
  <link rel="import" type="css" href="css/px-rangepicker.css"/>
  <template>
    <div class=overlay></div>
    <div class="rangepicker__box">
      <div class=flex>
        <div>
          <px-date-rangepicker
            id="dateRangePicker"
            from-date="{{fromDateInput}}"
            to-date="{{toDateInput}}"
            allow-future-dates="{{allowFutureDates}}">
          </px-date-rangepicker>
          <px-time-rangepicker
            id="timeRangePicker"
            from-time="{{fromTimeInput}}"
            to-time="{{toTimeInput}}">
          </px-time-rangepicker>
        </div>
        <px-rangepicker-presets class=u-p+>
        </px-rangepicker-presets>
      </div>
      <div class="flex flex--right u-p-">
        <input class="btn btn--primary" type=submit value=Apply on-click="_apply">
        <button class=btn on-click="_cancel">Cancel</button>
      </div>
    </div>
  </template>
</dom-module>

<script>
  Polymer({

    is: 'px-rangepicker-modal',

    properties: {

     /**
       * Moment object start time for time picker
       */
      fromTime: {
        type: Object,
        notify: true,
        observer: '_copyFromTime'
      },

      /**
       * Moment object end time for time picker
       */
      toTime: {
        type: Object,
        notify: true,
        observer: '_copyToTime'
      },

      /**
       * Moment object start date for date picker
       */
      fromDate: {
        type: Object,
        notify: true,
        observer: '_copyFromDate'
      },

      /**
       * Moment object end date for date picker
       */
      toDate: {
        type: Object,
        notify: true,
        observer: '_copyToDate'
      },

      /**
       * Set this attribute when you do want to allow future dates in the date range picker.
       *
       * If not set, then future dates will be disabled and unclickable.
       */
      allowFutureDates: {
        type: Boolean,
        value: false
      }

    },

    // make a local copy of all time/date inputs to make changes until the user hits Apply

    _copyToTime: function() {
      this.set('toTimeInput', moment(this.toTime));
    },

    _copyFromTime: function() {
      this.set('fromTimeInput', moment(this.fromTime));
    },

    _copyToDate: function() {
      this.set('toDateInput', moment(this.toDate));
    },

    _copyFromDate: function() {
      this.set('fromDateInput', moment(this.fromDate));
    },

    _apply: function() {
      this.set('toTime', moment(this.toTimeInput));
      this.set('fromTime', moment(this.fromTimeInput));
      this.set('fromDate', moment(this.fromDateInput));
      this.set('toDate', moment(this.toDateInput));
      this.$.dateRangePicker._resetState();

      this.fire('px-range-picking-done');
    },

    _cancel: function() {
      this.set('toTimeInput', moment(this.toTime));
      this.set('fromTimeInput', moment(this.fromTime));
      this.set('toDateInput', moment(this.toDate));
      this.set('fromDateInput', moment(this.fromDate));
      this.$.dateRangePicker._resetState();

      this.fire('px-range-picking-done');
    }

  });
</script>
