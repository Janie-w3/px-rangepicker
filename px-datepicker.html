<link rel="import" href="../polymer/polymer.html"/>
<link rel="import" href="px-calendar.html"/>

<script src="../moment/moment.js"></script>

<!--
Datepicker element which allows user to select a date.

##### Usage

    <px-datepicker selected-date="{{datePickerDate}}"></px-datepicker>

-->
<dom-module id="px-datepicker">
  <link rel="import" type="css" href="css/px-datepicker.css"/>
  <template>
    <div id="box" class="rangepicker__box u-pt+ u-pb-">
      <div class="flex flex--justify u-mh+ u--mb+ calendar__page">
        <button on-click="_jumpBack" class="btn btn--bare">
          <i class="fa fa-angle-left"></i>
        </button>
        <button on-click="_jumpForward" class="btn btn--bare">
          <i class="fa fa-angle-right"></i>
        </button>
      </div>
      <div class="flex border--bottom u-ph+">
        <px-calendar id="leftCalendar" class=u-mr+ display-month-year="{{leftDisplayMonthYear}}" last-clicked-date="{{lastClickedDate}}"></px-calendar>
        <px-calendar id="rightCalendar" class=u-ml+ display-month-year="{{rightDisplayMonthYear}}" last-clicked-date="{{lastClickedDate}}"></px-calendar>
      </div>
      <div class="flex flex--right u-pt- u-pr-">
        <input class="btn btn--primary" type=submit value=Apply on-click="_applyDate">
        <button class=btn on-click="_cancel">Cancel</button>
      </div>
    </div>
  </template>
</dom-module>

<script>
  Polymer({

    is: 'px-datepicker',

    properties: {

      /**
       * Selected date for date picker
       *
       * Format 'MM/DD/YYYY', for example: '01/25/2015' is Jan 25 2015
       */
      selectedDate: {
        type: String,
        observer: '_updateSelectedDate',
        notify: true
      },

      selectedDateOnLeft: {
        type: Boolean,
        observer: '_updateSelectedDateSide'
      }

    },

    _updateSelectedDateSide: function() {
      this._updateSelectedDate();
    },

    _resetInputFields: function() {
      if(this.selectedDateOnLeft) {
        this.set('leftDisplayMonthYear', moment(this.selectedDate, 'MM/DD/YYYY').format('MM/YYYY'));
        this.set('rightDisplayMonthYear', moment(this.selectedDate, 'MM/DD/YYYY').add(1, 'months').format('MM/YYYY'));
      }
      else {
        this.set('rightDisplayMonthYear', moment(this.selectedDate, 'MM/DD/YYYY').format('MM/YYYY'));
        this.set('leftDisplayMonthYear', moment(this.selectedDate, 'MM/DD/YYYY').subtract(1, 'months').format('MM/YYYY'));
      }

      this.set('lastClickedDate', this.selectedDate);
    },

    _updateSelectedDate: function() {
      this._resetInputFields();
    },

    _jumpBack: function() {
      this.set('leftDisplayMonthYear', moment(this.leftDisplayMonthYear, 'MM/YYYY').subtract(1, 'months').format('MM/YYYY'));
      this.set('rightDisplayMonthYear', moment(this.rightDisplayMonthYear, 'MM/YYYY').subtract(1, 'months').format('MM/YYYY'));
    },

    _jumpForward: function() {
      this.set('leftDisplayMonthYear', moment(this.leftDisplayMonthYear, 'MM/YYYY').add(1, 'months').format('MM/YYYY'));
      this.set('rightDisplayMonthYear', moment(this.rightDisplayMonthYear, 'MM/YYYY').add(1, 'months').format('MM/YYYY'));
    },

    _applyDate: function() {
      this.set('selectedDate', this.lastClickedDate); // set the selected date to the input date
      this.fire('px-date-picking-done');
    },

    _cancel: function() {
      this._resetInputFields(); // reset the input to the previously chosen date
      this.fire('px-date-picking-done');
    }


  });
</script>
